asrm.dev {
    log {
        output stdout
        format console
        level DEBUG
    }

    # --- API Laravel bajo /clinicamv/api... ---
    handle /clinicamv/api* {
        header {
            set X-Caddy-Block api
            set X-Debug-URI {uri}
        }
        uri strip_prefix /clinicamv      # -> Laravel ve /api/...

        # Front-controller SIEMPRE (deja a Laravel rutear)
        rewrite * /index.php

        # Muy importante: root dentro del bloque de php_fastcgi
        php_fastcgi clinicamv-php:9000 {
            root /var/www/public
            index index.php
            try_files {path} {path}/index.php index.php
        }
    }

    # --- Frontend Angular (catch-all bajo /clinicamv) ---
    handle_path /clinicamv* {
        header {
            set X-Caddy-Block frontend
            set X-Debug-URI {uri}
        }
        reverse_proxy clinicamv-frontend:80
    }

    # --- Estático /presentacion ---
    handle_path /presentacion* {
        root * /srv/presentacion
        file_server
    }

    # --- Raíz ---
    root * /srv/web-personal
    file_server
}
