asrm.dev {
    log {
        output stdout
        format console
        level DEBUG
    }

    # --- API Laravel bajo /clinicamv/api... ---
    # OJO: handle (no handle_path) y strip solo /clinicamv
    handle /clinicamv/api* {
        header {
            set X-Caddy-Block api
            set X-Debug-URI {uri}
        }
        uri strip_prefix /clinicamv      # => Laravel verá /api/...
        root * /var/www/public

        # ¡Sin rewrite! Deja que php_fastcgi haga el try_files interno
        php_fastcgi clinicamv-php:9000
    }

    # --- Frontend Angular (catch-all bajo /clinicamv) ---
    handle_path /clinicamv* {
        header {
            set X-Caddy-Block frontend
            set X-Debug-URI {uri}
        }
        reverse_proxy clinicamv-frontend:80
    }

    # --- Estático /presentacion ---
    handle_path /presentacion* {
        root * /srv/presentacion
        file_server
    }

    # --- Raíz ---
    root * /srv/web-personal
    file_server
}
